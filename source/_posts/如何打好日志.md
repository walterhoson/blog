---
title: 如何打好日志
date: 2019-06-01 09:15:00
tags: [Log,JAVA]
description: 打好日志是日常开发中比较重要的一项技能，好的日志埋点有助于排查及分析问题...
read_more: 阅读全文
categories: Skills
toc: true
# cover: /pic/abcd.jpg 封面缩略图
# thumbnail: /pic/abcd.jpg 归档页面缩略图
# excerpt: 这是一篇关于...
---

<!-- {% img /pic/abcd.jpg "Image title" %} -->


日志是了解程序运行状态的一个很好的途径。打好日志，显然是每个开发者的必备技能。

结合日常开发与思考，总结一下到底如何打好日志。

最重要的是要解决以下三个问题。

1. 在什么位置打日志
2. 打什么级别的日志
3. 日志中需要存在哪些信息

## 日志框架

常用的日志框架主要有log4j，Logging，commons-logging，slf4j，logback等等。一般在开发过程中推荐使用日志门户。目前比较推荐slf4j集成Logback。Logback相较于Log4j速度更快，内存占用更少。

## 日志等级

| 日志级别 | 描述                                               |
| :------- | :------------------------------------------------- |
| OFF      | 关闭：最高级别，不输出日志。                       |
| FATAL    | 致命：输出非常严重的可能会导致应用程序终止的错误。 |
| ERROR    | 错误：输出错误，但应用还能继续运行。               |
| WARN     | 警告：输出可能潜在的危险状况。                     |
| INFO     | 信息：输出应用运行过程的详细信息。                 |
| DEBUG    | 调试：输出更细致的对调试应用有用的信息。           |
| TRACE    | 跟踪：输出更细致的程序运行轨迹。                   |
| ALL      | 所有：输出所有级别信息。                           |

日志优先级标准排序：

> ALL < TRACE < DEBUG < INFO < WARN < ERROR < FATAL < OFF

总而言之，日志输出级别必须 **大于或等于** 系统的日志级别。例：系统设置日志级别为INFO，只有打INFO/DEBUG或更高级别才会有日志输出。

## 如何打日志

### DEBUG

1. 当你遇到问题的时候，只能通过debug功能来确定问题，你应该考虑打日志，良好的系统，是可以通过日志进行问题定位的。  注意，在debug是要使用``logger.isDebugEnabled()`` 进行判断，避免不必要的开销
2. 遇到if…else 或者 switch这样的分支时，在分支的首行打印日志，用来确定进入了哪个分支  
3. 经常以功能为核心进行开发，你应该在提交代码前，可以确定通过日志可以看到整个流程

### INFO

业务中的主要逻辑，重要信息。例如业务状态的变更，接口调用入参及出参等。

### ERROR

影响到程序正常运行的情况，系统逻辑错误，异常。

1. 打开配置文件失败 
2. 所有第三方对接的异常(包括第三方返回错误码)  。注意，如果抛出了异常不要记录日志，最终日志由最终处理者来记录。
3. 所有影响功能使用的异常，包括:SQLException和除了业务异常之外的所有异常(RuntimeException和Exception)

### TRACE

用于记录系统运行的完整信息。在业务代码中尽量不要使用


## 阿里开发手册供参考

1. 在日志输出时，字符串变量之间的拼接使用占位符的方式，禁止使用字符串相加，影响性能
2. 生产环境禁止直接使用 System.out 或 System.err 输出日志
3. 异常信息应该包括两类信息：案发现场信息和异常堆栈信息。如果不处理，那么通过关键字 throws 往上抛出
4. 禁止在日志打印时直接使用JSON工具转化对象。使用重写后的toString()
5. 谨慎记录日志，生产环境禁止输出debug。注意日志量，并且及时观察，避免撑爆服务器
6. 精简日志，只打有用的日志。首先需要考虑，是否有人看，看到后是否能协助排查问题。
7. 使用warn日志记录用户输入参数错误的情况，而非error。error只是打印系统逻辑错误，异常和重要错误信息。
